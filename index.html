<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 浏览器兼容声明 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <title>灵韵塔罗 - 探索内心的指引</title>
    <style>
        :root {
            --primary: #5a2e8a;
            --secondary: #1a1e3b;
            --accent: #d4af37;
            --light: #f0e6f6;
            --overlay: rgba(26, 30, 59, 0.85);
            --card-shadow: 0 8px 24px rgba(0,0,0,0.3);
            --transition: all 0.4s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: url('https://picsum.photos/id/1040/1920/1080') center/cover fixed;
            background-color: var(--secondary);
            background-blend-mode: overlay;
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            position: relative;
            animation: fadeIn 1s ease;
        }

        .header h1 {
            color: var(--accent);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .history-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            z-index: 10;
        }

        .history-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateY(-2px);
        }

        .screen {
            background: var(--overlay);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            animation: fadeIn 0.8s ease;
            display: none;
        }

        .screen.active {
            display: block;
        }

        .screen-title {
            color: var(--accent);
            margin-bottom: 25px;
            font-size: 1.5rem;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), #7b42b3);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-block;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(90, 46, 138, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(90, 46, 138, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .center-btn {
            text-align: center;
            margin: 20px 0;
        }

        /* 洗牌区域 */
        .shuffle-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
        }

        .deck {
            width: 120px;
            height: 180px;
            position: relative;
            margin: 20px 0;
            cursor: pointer;
        }

        .deck:hover .card-back {
            transform: translateY(-10px) rotate(5deg);
            box-shadow: var(--card-shadow);
        }

        .card-back {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c1e50, #4a2c86);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--accent);
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: absolute;
            top: 0;
            left: 0;
        }

        .shuffle-animation .card-back {
            animation: shuffle 1.5s ease infinite;
        }

        @keyframes shuffle {
            0%, 100% { transform: translateY(0) rotate(0); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(5px) rotate(-3deg); }
            75% { transform: translateY(-5px) rotate(2deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 牌阵区域 */
        .spread-area {
            margin: 40px 0;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .spread-name {
            color: var(--accent);
            margin-bottom: 30px;
            font-size: 1.4rem;
        }

        .spread-description {
            text-align: center;
            max-width: 800px;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        /* 单张牌阵 */
        .single-spread {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
        }

        /* 圣三角牌阵 */
        .triangle-spread {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 500px;
        }

        .triangle-spread .card-slot:nth-child(1) {
            grid-column: 2;
        }

        .triangle-spread .card-slot:nth-child(2) {
            grid-column: 1 / 4;
            justify-self: center;
        }

        .triangle-spread .card-slot:nth-child(3) {
            grid-column: 2;
        }

        /* 关系牌阵 */
        .relationship-spread {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            width: 100%;
            max-width: 900px;
        }

        /* 选择牌阵 */
        .choice-spread {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
            max-width: 800px;
        }

        .choice-header {
            grid-column: 1 / 3;
            display: flex;
            justify-content: center;
        }

        .choice-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .choice-label {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* 六芒星牌阵 */
        .star-spread {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 500px;
            margin: 0 auto;
        }

        .star-slot {
            position: absolute;
            width: 100px;
            height: 150px;
            transform: translate(-50%, -50%);
        }

        .star-slot:nth-child(1) { top: 100%; left: 50%; } /* 过去 - 6点 */
        .star-slot:nth-child(2) { top: 75%; left: 25%; }  /* 现在 - 8点 */
        .star-slot:nth-child(3) { top: 75%; left: 75%; }  /* 未来 - 4点 */
        .star-slot:nth-child(4) { top: 0; left: 50%; }     /* 原因 - 12点 */
        .star-slot:nth-child(5) { top: 25%; left: 25%; }   /* 环境 - 10点 */
        .star-slot:nth-child(6) { top: 25%; left: 75%; }   /* 策略 - 2点 */
        .star-slot:nth-child(7) { top: 50%; left: 50%; }   /* 态度 - 中心 */

        /* 牌位样式 */
        .card-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100px;
            height: 150px;
        }

        .slot-label {
            font-size: 0.9rem;
            text-align: center;
            opacity: 0.9;
            color: var(--accent);
        }

        .slot-desc {
            font-size: 0.8rem;
            text-align: center;
            opacity: 0.7;
        }

        /* 卡牌样式 */
        .card {
            width: 100px;
            height: 150px;
            position: relative;
            perspective: 1000px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: var(--card-shadow);
            border-radius: 8px;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            text-align: center;
        }

        .card-front {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transform: rotateY(180deg);
        }

        .card-name {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .card-position {
            font-size: 0.8rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .card.reversed .card-front {
            transform: rotateY(180deg) rotate(180deg);
        }

        /* 解释弹窗 */
        .card-tooltip {
            position: absolute;
            background: var(--overlay);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            padding: 15px;
            width: 250px;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tooltip-title {
            color: var(--accent);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .tooltip-content {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* 分析结果区域 */
        .analysis-area {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 25px;
            margin-top: 40px;
            border: 1px solid rgba(212, 175, 55, 0.1);
            animation: fadeIn 0.8s ease;
        }

        .analysis-title {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .analysis-content {
            line-height: 1.7;
            font-size: 1.05rem;
        }

        .deep-analysis-btn {
            background: linear-gradient(135deg, var(--accent), #e6c760);
            color: var(--secondary);
            margin-top: 20px;
        }

        /* 弹窗样式 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--secondary);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            transform: translateY(20px);
            transition: var(--transition);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--accent);
            transition: var(--transition);
        }

        .close-modal:hover {
            transform: scale(1.1);
        }

        .modal-title {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .qr-code-container {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }

        .qr-code {
            text-align: center;
        }

        .qr-code img {
            width: 150px;
            height: 150px;
            border: 2px solid var(--accent);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .payment-note {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--accent);
            padding: 10px 15px;
            margin: 20px 0;
            font-style: italic;
        }

        /* 历史记录样式 */
        .history-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: var(--transition);
        }

        .history-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }

        .history-question {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .history-date {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .relationship-spread {
                justify-content: center;
            }
            
            .choice-spread {
                grid-template-columns: 1fr;
            }
            
            .choice-header {
                grid-column: 1;
            }
            
            .star-spread {
                height: 400px;
            }
            
            .card, .card-slot, .star-slot {
                width: 80px;
                height: 120px;
            }
            
            .card-name, .slot-label {
                font-size: 0.8rem;
            }
            
            .card-position, .slot-desc {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>灵韵塔罗</h1>
            <p>探索内心的指引，揭示生活的可能</p>
            <button class="history-btn" onclick="showHistoryModal()">占卜历史</button>
        </div>

        <!-- 输入议题屏幕 -->
        <div id="question-screen" class="screen active">
            <h2 class="screen-title">请输入您的占卜议题</h2>
            <div class="input-group">
                <label for="question">您想探索什么问题？</label>
                <textarea id="question" placeholder="例如：我和他的关系会如何发展？我的事业会有新机会吗？" required></textarea>
            </div>
            <div class="center-btn">
                <button class="btn" onclick="goToSpreadSelection()">下一步：选择牌阵</button>
            </div>
        </div>

        <!-- 选择牌阵屏幕 -->
        <div id="spread-screen" class="screen">
            <h2 class="screen-title">选择适合您的牌阵</h2>
            <div class="input-group">
                <label for="spread-type">牌阵类型</label>
                <select id="spread-type" required>
                    <option value="single">单张牌阵 - 针对单一问题的快速指引</option>
                    <option value="triangle">圣三角牌阵 - 过去、现在、未来的发展</option>
                    <option value="relationship">一对一关系牌阵 - 深入了解双方关系</option>
                    <option value="choice">选择牌阵 - 面对抉择时的指引</option>
                    <option value="star">六芒星牌阵 - 全面分析问题的各个层面</option>
                </select>
            </div>
            <div class="center-btn">
                <button class="btn" onclick="goToQuestionScreen()">返回</button>
                <button class="btn" onclick="startReading()">开始占卜</button>
            </div>
        </div>

        <!-- 洗牌抽牌屏幕 -->
        <div id="shuffle-screen" class="screen">
            <h2 class="screen-title">洗牌与抽牌</h2>
            <div class="shuffle-area">
                <p>请点击牌组进行洗牌...</p>
                <div id="deck" class="deck" onclick="shuffleDeck()">
                    <div class="card-back">塔罗牌组</div>
                </div>
                <p id="shuffle-status">点击上方牌组开始洗牌</p>
                <button id="draw-btn" class="btn" style="display: none;" onclick="drawCards()">开始抽牌</button>
            </div>
        </div>

        <!-- 解牌结果屏幕 -->
        <div id="result-screen" class="screen">
            <h2 class="screen-title">您的占卜结果</h2>
            <div class="spread-area" id="spread-container">
                <!-- 牌阵将在这里动态生成 -->
            </div>
            <div class="analysis-area" id="analysis-container">
                <!-- 分析结果将在这里动态生成 -->
            </div>
            <div class="center-btn">
                <button class="btn deep-analysis-btn" onclick="showDeepAnalysisModal()">获取深度分析与疗愈建议</button>
                <button class="btn" onclick="startNewReading()">进行新的占卜</button>
            </div>
        </div>
    </div>

    <!-- 深度分析弹窗 -->
    <div id="deep-analysis-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="hideDeepAnalysisModal()">&times;</span>
            <h2 class="modal-title">深度分析与疗愈建议</h2>
            <p>感谢您选择灵韵塔罗。我们的专业塔罗师将为您提供更深入的解读和个性化的疗愈建议。</p>
            
            <div class="payment-note">
                <strong>重要提示：</strong> 深度分析服务为付费服务，一旦支付成功，将不予退款。
            </div>
            
            <div class="qr-code-container">
                <div class="qr-code">
                    <img src="https://placehold.co/150x150/FFFFFF/000000?text=微信支付" alt="微信支付">
                    <p>微信支付</p>
                </div>
                <div class="qr-code">
                    <img src="https://placehold.co/150x150/FFFFFF/000000?text=支付宝" alt="支付宝">
                    <p>支付宝</p>
                </div>
            </div>
            
            <div class="input-group">
                <label for="name">您的姓名</label>
                <input type="text" id="name" placeholder="请输入您的姓名" required>
            </div>
            <div class="input-group">
                <label for="phone">联系电话</label>
                <input type="tel" id="phone" placeholder="请输入您的手机号码" required>
            </div>
            <div class="input-group">
                <label for="email">电子邮箱</label>
                <input type="email" id="email" placeholder="请输入您的邮箱地址" required>
            </div>
            
            <div class="center-btn">
                <button class="btn" onclick="submitDeepAnalysisRequest()">提交申请</button>
            </div>
        </div>
    </div>

    <!-- 历史记录弹窗 -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="hideHistoryModal()">&times;</span>
            <h2 class="modal-title">我的占卜历史</h2>
            <div id="history-container">
                <!-- 历史记录将在这里动态生成 -->
            </div>
            <div class="center-btn">
                <button class="btn" onclick="clearHistory()">清空历史记录</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentQuestion = "";
        let selectedSpread = "single";
        let deck = [];
        let drawnCards = [];
        let readingInProgress = false;

        // 塔罗牌数据
        const tarotCards = [
            // 大阿卡那
            { name: "愚者", upright: "新的开始、自由、冒险、天真", reversed: "鲁莽、不负责任、天真" },
            { name: "魔术师", upright: "创造力、行动、资源运用", reversed: "缺乏计划、滥用权力" },
            { name: "女祭司", upright: "直觉、潜意识、神秘", reversed: "直觉被忽略、隐藏" },
            { name: "女皇", upright: "丰饶、生育、滋养、美", reversed: "依赖、懒惰、过度享乐" },
            { name: "皇帝", upright: "权威、结构、控制", reversed: "专制、控制欲、缺乏自律" },
            { name: "教皇", upright: "传统、灵性指导、教育", reversed: "教条、盲目跟随、缺乏远见" },
            { name: "恋人", upright: "爱、和谐、选择", reversed: "不和谐、错误的选择" },
            { name: "战车", upright: "胜利、控制、决心", reversed: "冲突、缺乏控制" },
            { name: "力量", upright: "内在力量、勇气、耐心", reversed: "软弱、缺乏勇气" },
            { name: "隐士", upright: "内省、智慧、独处", reversed: "孤独、退缩、冷漠" },
            { name: "命运之轮", upright: "变化、命运、循环", reversed: "抗拒变化、坏运气" },
            { name: "正义", upright: "公平、正义、平衡", reversed: "不公平、偏见" },
            { name: "倒吊人", upright: "牺牲、暂停、视角转变", reversed: "不必要的牺牲、徒劳" },
            { name: "死神", upright: "结束、转变、重生", reversed: "抗拒变化、恐惧" },
            { name: "节制", upright: "平衡、和谐、调和", reversed: "失衡、过度" },
            { name: "恶魔", upright: "诱惑、束缚、物质主义", reversed: "解放、摆脱束缚" },
            { name: "塔", upright: "突然变化、混乱、觉醒", reversed: "抗拒改变、延迟" },
            { name: "星星", upright: "希望、灵感、灵性", reversed: "绝望、缺乏信心" },
            { name: "月亮", upright: "直觉、不确定性、隐忧", reversed: "困惑、恐惧、欺骗" },
            { name: "太阳", upright: "喜悦、成功、活力", reversed: "缺乏活力、暂时的挫折" },
            { name: "审判", upright: "重生、觉醒、评估", reversed: "犹豫不决、内省" },
            { name: "世界", upright: "完成、成功、旅行", reversed: "未完成、停滞" },
            
            // 小阿卡那 - 权杖
            { name: "权杖 Ace", upright: "新行动、创造力、潜能", reversed: "缺乏动力、延迟" },
            { name: "权杖 2", upright: "计划、平衡、决定", reversed: "犹豫不决、缺乏计划" },
            { name: "权杖 3", upright: "远见、扩展、旅行", reversed: "缺乏远见、停滞" },
            { name: "权杖 4", upright: "稳定、庆祝、家庭", reversed: "不稳定、冲突" },
            { name: "权杖 5", upright: "冲突、竞争、挑战", reversed: "避免冲突、退缩" },
            { name: "权杖 6", upright: "胜利、自信、进展", reversed: "失败、缺乏自信" },
            { name: "权杖 7", upright: "坚持、防御、勇气", reversed: "放弃、缺乏勇气" },
            { name: "权杖 8", upright: "迅速行动、自由、旅行", reversed: "延迟、限制" },
            { name: "权杖 9", upright: "警惕、准备、耐心", reversed: "恐惧、缺乏准备" },
            { name: "权杖 10", upright: "负担、压力、责任", reversed: "释放负担、授权" },
            { name: "权杖侍从", upright: "新想法、热情、信使", reversed: "不切实际、缺乏跟进" },
            { name: "权杖骑士", upright: "行动、冒险、热情", reversed: "冲动、鲁莽" },
            { name: "权杖王后", upright: "热情、创造力、自信", reversed: "情绪化、缺乏焦点" },
            { name: "权杖国王", upright: "领导力、权威、稳定", reversed: "专制、缺乏远见" },
            
            // 小阿卡那 - 圣杯
            { name: "圣杯 Ace", upright: "新情感、爱、直觉", reversed: "情感挫折、失落" },
            { name: "圣杯 2", upright: "伙伴关系、和谐、爱", reversed: "冲突、不平衡" },
            { name: "圣杯 3", upright: "庆祝、友谊、合作", reversed: "缺乏社交、孤立" },
            { name: "圣杯 4", upright: "沉思、不满、退缩", reversed: "新机会、接受" },
            { name: "圣杯 5", upright: "失落、悲伤、失望", reversed: "接受、新视角" },
            { name: "圣杯 6", upright: "怀旧、给予和接受、和谐", reversed: "不平衡的关系" },
            { name: "圣杯 7", upright: "幻想、选择、梦想", reversed: "不切实际、混乱" },
            { name: "圣杯 8", upright: "离开、寻找更多、情感成长", reversed: "停滞、害怕改变" },
            { name: "圣杯 9", upright: "满足、幸福、自给自足", reversed: "不满、缺乏自信" },
            { name: "圣杯 10", upright: "家庭幸福、和谐、满足", reversed: "家庭冲突、不满足" },
            { name: "圣杯侍从", upright: "新情感、创造力、直觉", reversed: "情感不成熟、天真" },
            { name: "圣杯骑士", upright: "浪漫、敏感、行动", reversed: "情绪波动、不可靠" },
            { name: "圣杯王后", upright: "同情心、爱、情感稳定", reversed: "情感依赖、过度敏感" },
            { name: "圣杯国王", upright: "情感平衡、领导力、明智", reversed: "情感冷漠、不切实际" },
            
            // 小阿卡那 - 宝剑
            { name: "宝剑 Ace", upright: "新思想、真相、突破", reversed: "混乱、误解" },
            { name: "宝剑 2", upright: "平衡、和平、调解", reversed: "冲突、僵局" },
            { name: "宝剑 3", upright: "心碎、悲伤、失落", reversed: "疗愈、接受" },
            { name: "宝剑 4", upright: "休息、恢复、冥想", reversed: "倦怠、拖延" },
            { name: "宝剑 5", upright: "冲突、胜利、竞争", reversed: "和解、失败" },
            { name: "宝剑 6", upright: "和平、缓慢进展、过渡", reversed: "停滞、抗拒" },
            { name: "宝剑 7", upright: "策略、秘密、欺骗", reversed: "诚实、暴露" },
            { name: "宝剑 8", upright: "限制、监禁、恐惧", reversed: "自由、新视角" },
            { name: "宝剑 9", upright: "焦虑、噩梦、恐惧", reversed: "释放、疗愈" },
            { name: "宝剑 10", upright: "痛苦的结束、转变、新开始", reversed: "延迟的结束、抗拒" },
            { name: "宝剑侍从", upright: "新想法、好奇心、学习", reversed: "分心、缺乏焦点" },
            { name: "宝剑骑士", upright: "行动、真相、直接", reversed: "鲁莽、冲突" },
            { name: "宝剑王后", upright: "清晰、智慧、独立", reversed: "混乱、冷酷" },
            { name: "宝剑国王", upright: "权威、智慧、公正", reversed: "专制、苛刻" },
            
            // 小阿卡那 - 星币
            { name: "星币 Ace", upright: "新财务、繁荣、物质", reversed: "财务损失、延迟" },
            { name: "星币 2", upright: "平衡、适应、灵活性", reversed: "不平衡、不稳定" },
            { name: "星币 3", upright: "合作、团队合作、技能", reversed: "缺乏合作、不和谐" },
            { name: "星币 4", upright: "稳定、安全、占有", reversed: "吝啬、不安全" },
            { name: "星币 5", upright: "财务困难、损失、担忧", reversed: "财务改善、新希望" },
            { name: "星币 6", upright: "给予和接受、慈善、分享", reversed: "不平等、贪婪" },
            { name: "星币 7", upright: "耐心、投资、长期规划", reversed: "不耐烦、缺乏规划" },
            { name: "星币 8", upright: "技能、专注、精益求精", reversed: "缺乏努力、分心" },
            { name: "星币 9", upright: "富足、独立、自给自足", reversed: "贪婪、物质主义" },
            { name: "星币 10", upright: "家庭、遗产、长期安全", reversed: "家庭冲突、财务不稳定" },
            { name: "星币侍从", upright: "新财务机会、学习、实践", reversed: "不切实际、浪费" },
            { name: "星币骑士", upright: "务实、可靠、稳定", reversed: "懒惰、缺乏动力" },
            { name: "星币王后", upright: "滋养、实际、财务安全", reversed: "财务担忧、不切实际" },
            { name: "星币国王", upright: "商业、领导力、财务成功", reversed: "财务失败、不负责任" }
        ];

        // 牌阵配置
        const spreads = {
            single: {
                name: "单张牌阵",
                description: "单张牌阵是最简单直接的占卜方式，为您的问题提供核心指引和关键洞察。",
                positions: [
                    { label: "核心指引", description: "针对您问题的核心答案和指引" }
                ]
            },
            triangle: {
                name: "圣三角牌阵",
                description: "圣三角牌阵是最经典的塔罗牌阵之一，它能揭示您过去、现在和未来的状况，帮助您理解事件的发展脉络。",
                positions: [
                    { label: "过去", description: "影响当前情况的过去事件" },
                    { label: "现在", description: "您当前的状况和面临的挑战" },
                    { label: "未来", description: "未来可能的发展趋势" }
                ]
            },
            relationship: {
                name: "一对一关系牌阵",
                description: "此牌阵专为探索人际关系而设计，特别适合恋爱关系。它能揭示双方的感受、关系现状和未来发展。",
                positions: [
                    { label: "我如何看待对方", description: "您对对方的真实感受和看法" },
                    { label: "对方如何看待我", description: "对方对您的感受和看法" },
                    { label: "我们的互动状态", description: "您们之间的关系现状和互动模式" },
                    { label: "关系的发展", description: "关系未来的发展趋势" },
                    { label: "关系的建议", description: "改善或发展关系的建议" }
                ]
            },
            choice: {
                name: "选择牌阵",
                description: "当您面临重要抉择时，选择牌阵可以帮助您清晰地看到每个选择的利弊和可能结果，从而做出最适合自己的决定。",
                positions: [
                    { label: "当前能量", description: "您当前的整体状态和能量" },
                    { label: "选择A现状", description: "选择A的当前状况" },
                    { label: "选择A未来", description: "选择A的未来发展趋势" },
                    { label: "选择B现状", description: "选择B的当前状况" },
                    { label: "选择B未来", description: "选择B的未来发展趋势" }
                ]
            },
            star: {
                name: "六芒星牌阵",
                description: "六芒星牌阵是一个全面而深入的占卜方式，它能揭示问题的根源、现状、挑战和未来发展，为您提供全面的指引。",
                positions: [
                    { label: "过去", description: "影响当前情况的过去因素" },
                    { label: "现在", description: "您当前的状况和面临的挑战" },
                    { label: "未来", description: "未来可能的发展趋势" },
                    { label: "根源", description: "问题背后的根本原因" },
                    { label: "环境", description: "周围环境对您的影响" },
                    { label: "未来影响", description: "未来可能出现的影响因素" },
                    { label: "最终结果", description: "最终可能的结果和建议" }
                ]
            }
        };

        // 页面导航
        function goToSpreadSelection() {
            const question = document.getElementById("question").value.trim();
            if (!question) {
                alert("请输入您的占卜议题");
                return;
            }
            currentQuestion = question;
            document.getElementById("question-screen").classList.remove("active");
            document.getElementById("spread-screen").classList.add("active");
        }

        function goToQuestionScreen() {
            document.getElementById("spread-screen").classList.remove("active");
            document.getElementById("question-screen").classList.add("active");
        }

        function startReading() {
            selectedSpread = document.getElementById("spread-type").value;
            document.getElementById("spread-screen").classList.remove("active");
            document.getElementById("shuffle-screen").classList.add("active");
            
            // 初始化牌组
            initializeDeck();
        }

        function startNewReading() {
            document.getElementById("result-screen").classList.remove("active");
            document.getElementById("question-screen").classList.add("active");
            document.getElementById("question").value = "";
            document.getElementById("spread-type").value = "single";
            currentQuestion = "";
            selectedSpread = "single";
            deck = [];
            drawnCards = [];
            readingInProgress = false;
        }

        // 牌组操作
        function initializeDeck() {
            deck = [];
            // 创建一副完整的塔罗牌
            tarotCards.forEach(card => {
                deck.push({
                    ...card,
                    id: Math.random().toString(36).substr(2, 9) // 生成唯一ID
                });
            });
            document.getElementById("shuffle-status").textContent = "点击上方牌组开始洗牌";
            document.getElementById("draw-btn").style.display = "none";
        }

        function shuffleDeck() {
            if (readingInProgress) return;
            
            readingInProgress = true;
            const deckElement = document.getElementById("deck");
            const statusElement = document.getElementById("shuffle-status");
            
            statusElement.textContent = "正在洗牌...";
            deckElement.classList.add("shuffle-animation");
            
            // 模拟洗牌过程
            setTimeout(() => {
                // Fisher-Yates 洗牌算法
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                
                deckElement.classList.remove("shuffle-animation");
                statusElement.textContent = "洗牌完成，请抽牌";
                document.getElementById("draw-btn").style.display = "inline-block";
                readingInProgress = false;
            }, 2000);
        }

        function drawCards() {
            if (readingInProgress) return;
            
            readingInProgress = true;
            const spreadConfig = spreads[selectedSpread];
            drawnCards = [];
            
            // 抽取所需数量的牌
            for (let i = 0; i < spreadConfig.positions.length; i++) {
                // 随机抽取一张牌
                const randomIndex = Math.floor(Math.random() * deck.length);
                const drawnCard = deck.splice(randomIndex, 1)[0];
                
                // 随机决定正逆位
                const isReversed = Math.random() > 0.5;
                
                drawnCards.push({
                    ...drawnCard,
                    position: spreadConfig.positions[i],
                    reversed: isReversed
                });
            }
            
            // 显示结果
            displayResults();
            readingInProgress = false;
        }

        // 显示结果
        function displayResults() {
            const spreadContainer = document.getElementById("spread-container");
            const analysisContainer = document.getElementById("analysis-container");
            
            // 清空容器
            spreadContainer.innerHTML = "";
            analysisContainer.innerHTML = "";
            
            // 获取牌阵配置
            const spreadConfig = spreads[selectedSpread];
            
            // 创建牌阵标题和描述
            const spreadTitle = document.createElement("h3");
            spreadTitle.className = "spread-name";
            spreadTitle.textContent = spreadConfig.name;
            
            const spreadDesc = document.createElement("p");
            spreadDesc.className = "spread-description";
            spreadDesc.textContent = spreadConfig.description;
            
            spreadContainer.appendChild(spreadTitle);
            spreadContainer.appendChild(spreadDesc);
            
            // 创建牌阵容器
            const spreadElement = document.createElement("div");
            spreadElement.className = `${selectedSpread}-spread`;
            
            // 添加牌到牌阵
            drawnCards.forEach((card, index) => {
                const cardSlot = document.createElement("div");
                cardSlot.className = selectedSpread === "star" ? "star-slot" : "card-slot";
                
                const slotLabel = document.createElement("div");
                slotLabel.className = "slot-label";
                slotLabel.textContent = `${index + 1}. ${card.position.label}`;
                
                const slotDesc = document.createElement("div");
                slotDesc.className = "slot-desc";
                slotDesc.textContent = card.position.description;
                
                const cardElement = document.createElement("div");
                cardElement.className = `card ${card.reversed ? "reversed" : ""}`;
                cardElement.dataset.cardId = card.id;
                cardElement.onclick = function() {
                    this.classList.toggle("flipped");
                };
                
                // 添加鼠标悬停效果
                cardElement.onmouseenter = function(e) {
                    showCardTooltip(e, card);
                };
                
                cardElement.onmouseleave = function() {
                    hideCardTooltip();
                };
                
                const cardInner = document.createElement("div");
                cardInner.className = "card-inner";
                
                const cardFront = document.createElement("div");
                cardFront.className = "card-front";
                
                const cardName = document.createElement("div");
                cardName.className = "card-name";
                cardName.textContent = card.name;
                
                const cardPosition = document.createElement("div");
                cardPosition.className = "card-position";
                cardPosition.textContent = card.reversed ? "逆位" : "正位";
                
                const cardBack = document.createElement("div");
                cardBack.className = "card-back";
                cardBack.textContent = "TAROT";
                
                cardFront.appendChild(cardName);
                cardFront.appendChild(cardPosition);
                cardInner.appendChild(cardFront);
                cardInner.appendChild(cardBack);
                cardElement.appendChild(cardInner);
                
                cardSlot.appendChild(slotLabel);
                cardSlot.appendChild(slotDesc);
                cardSlot.appendChild(cardElement);
                
                spreadElement.appendChild(cardSlot);
            });
            
            spreadContainer.appendChild(spreadElement);
            
            // 生成分析内容
            const analysisTitle = document.createElement("h3");
            analysisTitle.className = "analysis-title";
            analysisTitle.textContent = "综合解读";
            
            const analysisContent = document.createElement("div");
            analysisContent.className = "analysis-content";
            analysisContent.innerHTML = generateAnalysis();
            
            analysisContainer.appendChild(analysisTitle);
            analysisContainer.appendChild(analysisContent);
            
            // 保存到历史记录
            saveToHistory();
            
            // 显示结果屏幕
            document.getElementById("shuffle-screen").classList.remove("active");
            document.getElementById("result-screen").classList.add("active");
        }

        // 生成分析解读
        function generateAnalysis() {
            let analysis = `<p>针对您提出的问题："${currentQuestion}"，我们使用了${spreads[selectedSpread].name}进行占卜，得到以下解读：</p>`;
            
            // 为每种牌阵生成特定的分析
            switch(selectedSpread) {
                case "single":
                    analysis += `<p>抽到的牌是 <strong>${drawnCards[0].name}</strong>（${drawnCards[0].reversed ? "逆位" : "正位"}）。这张牌代表了您问题的核心。</p>`;
                    analysis += `<p>${drawnCards[0].reversed ? drawnCards[0].reversed : drawnCards[0].upright}</p>`;
                    analysis += `<p>这张牌暗示您${drawnCards[0].reversed ? "可能需要注意" : "可以考虑"}${drawnCards[0].reversed ? drawnCards[0].reversed.toLowerCase() : drawnCards[0].upright.toLowerCase()}方面的因素。</p>`;
                    break;
                    
                case "triangle":
                    analysis += `<p><strong>过去</strong>（${drawnCards[0].name}）：${drawnCards[0].reversed ? drawnCards[0].reversed : drawnCards[0].upright}</p>`;
                    analysis += `<p><strong>现在</strong>（${drawnCards[1].name}）：${drawnCards[1].reversed ? drawnCards[1].reversed : drawnCards[1].upright}</p>`;
                    analysis += `<p><strong>未来</strong>（${drawnCards[2].name}）：${drawnCards[2].reversed ? drawnCards[2].reversed : drawnCards[2].upright}</p>`;
                    analysis += `<p>综合来看，您的过去经历${drawnCards[0].name.toLowerCase()}为您现在的处境奠定了基础。当前您正处于${drawnCards[1].name.toLowerCase()}的状态，这可能带来${drawnCards[1].reversed ? "挑战" : "机遇"}。展望未来，${drawnCards[2].name.toLowerCase()}预示着${drawnCards[2].reversed ? "需要克服的障碍" : "积极的发展"}。</p>`;
                    break;
                    
                case "relationship":
                    analysis += `<p><strong>您对对方的看法</strong>（${drawnCards[0].name}）：${drawnCards[0].reversed ? drawnCards[0].reversed : drawnCards[0].upright}</p>`;
                    analysis += `<p><strong>对方对您的看法</strong>（${drawnCards[1].name}）：${drawnCards[1].reversed ? drawnCards[1].reversed : drawnCards[1].upright}</p>`;
                    analysis += `<p><strong>当前关系状态</strong>（${drawnCards[2].name}）：${drawnCards[2].reversed ? drawnCards[2].reversed : drawnCards[2].upright}</p>`;
                    analysis += `<p><strong>关系发展趋势</strong>（${drawnCards[3].name}）：${drawnCards[3].reversed ? drawnCards[3].reversed : drawnCards[3].upright}</p>`;
                    analysis += `<p><strong>关系建议</strong>（${drawnCards[4].name}）：${drawnCards[4].reversed ? drawnCards[4].reversed : drawnCards[4].upright}</p>`;
                    analysis += `<p>这段关系中，您和对方似乎对彼此有着${drawnCards[0].name.toLowerCase()}和${drawnCards[1].name.toLowerCase()}的感受。当前关系处于${drawnCards[2].name.toLowerCase()}的状态，未来可能会${drawnCards[3].reversed ? "面临挑战" : "向好发展"}。${drawnCards[4].name.toLowerCase()}的建议提示您${drawnCards[4].reversed ? "需要避免" : "可以尝试"}某些行为。</p>`;
                    break;
                    
                case "choice":
                    analysis += `<p><strong>您当前的能量</strong>（${drawnCards[0].name}）：${drawnCards[0].reversed ? drawnCards[0].reversed : drawnCards[0].upright}</p>`;
                    analysis += `<p><strong>选择A现状</strong>（${drawnCards[1].name}）：${drawnCards[1].reversed ? drawnCards[1].reversed : drawnCards[1].upright}</p>`;
                    analysis += `<p><strong>选择A未来</strong>（${drawnCards[2].name}）：${drawnCards[2].reversed ? drawnCards[2].reversed : drawnCards[2].upright}</p>`;
                    analysis += `<p><strong>选择B现状</strong>（${drawnCards[3].name}）：${drawnCards[3].reversed ? drawnCards[3].reversed : drawnCards[3].upright}</p>`;
                    analysis += `<p><strong>选择B未来</strong>（${drawnCards[4].name}）：${drawnCards[4].reversed ? drawnCards[4].reversed : drawnCards[4].upright}</p>`;
                    analysis += `<p>在做决定时，您当前的能量状态是${drawnCards[0].name.toLowerCase()}。选择A目前处于${drawnCards[1].name.toLowerCase()}的状态，未来可能会${drawnCards[2].reversed ? "面临挑战" : "带来机遇"}。选择B目前处于${drawnCards[3].name.toLowerCase()}的状态，未来发展趋势是${drawnCards[4].reversed ? "不确定的" : "积极的"}。</p>`;
                    analysis += `<p>综合来看，${drawnCards[2].reversed && !drawnCards[4].reversed ? "选择B可能更适合您当前的情况。" : !drawnCards[2].reversed && drawnCards[4].reversed ? "选择A似乎更有前景。" : "两种选择各有优劣，最终决定应基于您的价值观和长期目标。"}</p>`;
                    break;
                    
                case "star":
                    analysis += `<p><strong>过去影响</strong>（${drawnCards[0].name}）：${drawnCards[0].reversed ? drawnCards[0].reversed : drawnCards[0].upright}</p>`;
                    analysis += `<p><strong>当前状况</strong>（${drawnCards[1].name}）：${drawnCards[1].reversed ? drawnCards[1].reversed : drawnCards[1].upright}</p>`;
                    analysis += `<p><strong>未来趋势</strong>（${drawnCards[2].name}）：${drawnCards[2].reversed ? drawnCards[2].reversed : drawnCards[2].upright}</p>`;
                    analysis += `<p><strong>问题根源</strong>（${drawnCards[3].name}）：${drawnCards[3].reversed ? drawnCards[3].reversed : drawnCards[3].upright}</p>`;
                    analysis += `<p><strong>环境影响</strong>（${drawnCards[4].name}）：${drawnCards[4].reversed ? drawnCards[4].reversed : drawnCards[4].upright}</p>`;
                    analysis += `<p><strong>未来影响</strong>（${drawnCards[5].name}）：${drawnCards[5].reversed ? drawnCards[5].reversed : drawnCards[5].upright}</p>`;
                    analysis += `<p><strong>最终结果</strong>（${drawnCards[6].name}）：${drawnCards[6].reversed ? drawnCards[6].reversed : drawnCards[6].upright}</p>`;
                    analysis += `<p>您的问题根源在于${drawnCards[3].name.toLowerCase()}，这受到了${drawnCards[0].name.toLowerCase()}的过去影响。当前，您处于${drawnCards[1].name.toLowerCase()}的状况，周围环境带来${drawnCards[4].name.toLowerCase()}的影响。</p>`;
                    analysis += `<p>展望未来，${drawnCards[2].name.toLowerCase()}预示着${drawnCards[2].reversed ? "挑战" : "机遇"}，而${drawnCards[5].name.toLowerCase()}可能会成为关键影响因素。最终，${drawnCards[6].name.toLowerCase()}暗示着${drawnCards[6].reversed ? "需要努力克服的结果" : "积极的最终结果"}。</p>`;
                    break;
            }
            
            analysis += `<p>塔罗牌的指引并非绝对的预言，而是提供一种可能性和视角。请记住，您始终拥有自由意志，可以根据这些洞见做出最适合自己的选择。</p>`;
            
            return analysis;
        }

        // 牌意弹窗
        function showCardTooltip(event, card) {
            // 先隐藏任何已存在的弹窗
            hideCardTooltip();
            
            const tooltip = document.createElement("div");
            tooltip.className = "card-tooltip";
            tooltip.id = "card-tooltip";
            
            const title = document.createElement("div");
            title.className = "tooltip-title";
            title.textContent = `${card.name}（${card.reversed ? "逆位" : "正位"}）`;
            
            const content = document.createElement("div");
            content.className = "tooltip-content";
            content.textContent = card.reversed ? card.reversed : card.upright;
            
            tooltip.appendChild(title);
            tooltip.appendChild(content);
            document.body.appendChild(tooltip);
            
            // 定位弹窗
            const cardRect = event.target.getBoundingClientRect();
            tooltip.style.left = `${cardRect.right + 15}px`;
            tooltip.style.top = `${cardRect.top}px`;
            
            // 确保弹窗不会超出视口
            const tooltipRect = tooltip.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth) {
                tooltip.style.left = `${cardRect.left - tooltipRect.width - 15}px`;
            }
            if (tooltipRect.bottom > window.innerHeight) {
                tooltip.style.top = `${cardRect.bottom - tooltipRect.height}px`;
            }
            
            tooltip.style.display = "block";
        }

        function hideCardTooltip() {
            const tooltip = document.getElementById("card-tooltip");
            if (tooltip) {
                document.body.removeChild(tooltip);
            }
        }

        // 深度分析模态框
        function showDeepAnalysisModal() {
            document.getElementById("deep-analysis-modal").classList.add("active");
        }

        function hideDeepAnalysisModal() {
            document.getElementById("deep-analysis-modal").classList.remove("active");
        }

        function submitDeepAnalysisRequest() {
            const name = document.getElementById("name").value;
            const phone = document.getElementById("phone").value;
            const email = document.getElementById("email").value;
            
            if (!name || !phone || !email) {
                alert("请填写完整的联系信息");
                return;
            }
            
            // 这里可以添加实际的提交逻辑
            alert("您的深度分析请求已提交！我们的专业塔罗师将在24小时内通过邮件与您联系。");
            hideDeepAnalysisModal();
        }

        // 历史记录功能
        function saveToHistory() {
            const history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
            
            // 创建历史记录项
            const historyItem = {
                id: Date.now(),
                question: currentQuestion,
                spread: selectedSpread,
                spreadName: spreads[selectedSpread].name,
                cards: drawnCards,
                date: new Date().toLocaleString()
            };
            
            // 添加到历史记录并限制数量为10条
            history.unshift(historyItem);
            if (history.length > 10) {
                history.pop();
            }
            
            localStorage.setItem("tarotHistory", JSON.stringify(history));
        }

        function showHistoryModal() {
            const historyContainer = document.getElementById("history-container");
            const history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
            
            // 清空容器
            historyContainer.innerHTML = "";
            
            if (history.length === 0) {
                historyContainer.innerHTML = "<p>暂无占卜历史记录。</p>";
                document.getElementById("history-modal").classList.add("active");
                return;
            }
            
            // 添加历史记录项
            history.forEach(item => {
                const historyItem = document.createElement("div");
                historyItem.className = "history-item";
                historyItem.dataset.historyId = item.id;
                historyItem.onclick = function() {
                    viewHistoryItem(parseInt(this.dataset.historyId));
                };
                
                const question = document.createElement("div");
                question.className = "history-question";
                question.textContent = item.question;
                
                const spread = document.createElement("div");
                spread.textContent = `牌阵：${item.spreadName}`;
                
                const date = document.createElement("div");
                date.className = "history-date";
                date.textContent = item.date;
                
                historyItem.appendChild(question);
                historyItem.appendChild(spread);
                historyItem.appendChild(date);
                
                historyContainer.appendChild(historyItem);
            });
            
            document.getElementById("history-modal").classList.add("active");
        }

        function hideHistoryModal() {
            document.getElementById("history-modal").classList.remove("active");
        }

        function clearHistory() {
            if (confirm("确定要清空所有占卜历史记录吗？此操作不可恢复。")) {
                localStorage.removeItem("tarotHistory");
                showHistoryModal(); // 刷新显示
            }
        }

        function viewHistoryItem(historyId) {
            const history = JSON.parse(localStorage.getItem("tarotHistory") || "[]");
            const item = history.find(h => h.id === historyId);
            
            if (!item) return;
            
            // 保存当前状态
            const currentDrawnCards = [...drawnCards];
            
            // 使用历史记录数据
            currentQuestion = item.question;
            selectedSpread = item.spread;
            drawnCards = item.cards;
            
            // 显示结果
            displayResults();
            
            // 恢复当前状态（可选，取决于你希望如何处理）
            // drawnCards = currentDrawnCards;
            
            hideHistoryModal();
        }

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const deepModal = document.getElementById("deep-analysis-modal");
            const historyModal = document.getElementById("history-modal");
            
            if (event.target === deepModal) {
                hideDeepAnalysisModal();
            }
            
            if (event.target === historyModal) {
                hideHistoryModal();
            }
        };

        // 初始化页面
        document.addEventListener("DOMContentLoaded", function() {
            // 检查浏览器兼容性
            if (!Array.prototype.includes) {
                Array.prototype.includes = function(searchElement /*, fromIndex*/) {
                    'use strict';
                    var O = Object(this);
                    var len = parseInt(O.length, 10) || 0;
                    if (len === 0) {
                        return false;
                    }
                    var n = parseInt(arguments[1], 10) || 0;
                    var k;
                    if (n >= 0) {
                        k = n;
                    } else {
                        k = len + n;
                        if (k < 0) {k = 0;}
                    }
                    var currentElement;
                    while (k < len) {
                        currentElement = O[k];
                        if (searchElement === currentElement ||
                            (searchElement !== searchElement && currentElement !== currentElement)) {
                            return true;
                        }
                        k++;
                    }
                    return false;
                };
            }
        });
    </script>
</body>
</html>
